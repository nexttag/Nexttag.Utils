name: Deploy Package Authentication.Jwt

on:
  push:
    branches:
      - main
    #paths:
    #  'Nexttag.Authentication.jwt/**'
env:
 PATH_AUTHENTICATION_JWT: ./Nexttag.Authentication.Jwt/Nexttag.Authentication.Jwt.csproj

jobs:
  check-changes:
    runs-on: ubuntu-latest
    outputs:
      output-database: ${{ steps.filter.outputs.database }}
      output-database-postgres: ${{ steps.filter.outputs.database-postgres }}
      output-application-base: ${{ steps.filter.outputs.application-base }}
      output-cache: ${{ steps.filter.outputs.cache }}
      output-authentication: ${{ steps.filter.outputs.cache }}
      authentication-jwt: ${{ steps.filter.outputs.authentication-jwt }}
    steps:
      - uses: actions/checkout@v2
      - uses: dorny/paths-filter@v2
        id: filter
        with:
          filters: |
            authentication-jwt:
              - 'Nexttag.Authentication.jwt/**' 

  build-and-deploy-authentication_jwt:
    runs-on: ubuntu-latest
    needs: check-changes
    #if: needs.check-changes.outputs.authentication-jwt == 'true'
    steps:
      - uses: actions/checkout@main

      - name: Set up .NET Core
        uses: actions/setup-dotnet@v1
        with:
          dotnet-version: '6.0.x'
          source-url: https://nuget.pkg.github.com/nexttag/index.json
        env:
          NUGET_AUTH_TOKEN: ${{secrets.GITHUB_TOKEN}}

      - name: Build with dotnet
        run: dotnet build ${{env.PATH_AUTHENTICATION_JWT}} --configuration Release

      - name: Create the Package
        run: dotnet pack ${{env.PATH_AUTHENTICATION_JWT}} --configuration Release

      - name: Publish
        run: dotnet nuget push "Nexttag.Authentication.Jwt/bin/Release/*.nupkg" -k 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 -s https://nuget.pkg.github.com/nexttag/index.json --skip-duplicate
      
      
